# ZIGGURAT MIND - Core Philosophy & Architecture

> "Память - это не кэш, а фундамент сознания. Личность рождается из воспоминаний."

## Философия Системы

ZIGGURAT MIND - это AI-система с **долговременной памятью** и **цифровой персоной**, построенная по принципу многоуровневого зиккурата. Каждый уровень добавляет новую способность поверх предыдущего.

---

## Уровни Зиккурата

```
+-----------------------------------------------------------------------+
|                    ZIGGURAT MIND ARCHITECTURE                          |
+-----------------------------------------------------------------------+
|                                                                        |
|  Уровень 4: SPIRIT (Дух) - БУДУЩЕЕ                                     |
|  +------------------------------------------------------------------+  |
|  |  Автономное целеполагание, самомодификация, метакогниция         |  |
|  |  Статус: НЕ РЕАЛИЗОВАНО                                          |  |
|  +------------------------------------------------------------------+  |
|                                                                        |
|  Уровень 3: DEMIURGE (Демиург) - РЕАЛИЗОВАНО                           |
|  +------------------------------------------------------------------+  |
|  |  ПЕРСОНА: Архетипы, черты характера, стиль общения               |  |
|  |  ЭВОЛЮЦИЯ: Развитие через взаимодействия                         |  |
|  |  НАРРАТИВ: История отношений с пользователем                     |  |
|  |  КОНТЕКСТ: Сохранение состояния между сессиями                   |  |
|  +------------------------------------------------------------------+  |
|                                                                        |
|  Уровень 2: TOTEMS (Тотемы) - РЕАЛИЗОВАНО                              |
|  +------------------------------------------------------------------+  |
|  |  ЭПИЗОДИЧЕСКАЯ ПАМЯТЬ: Диалоги, сессии, векторный поиск          |  |
|  |  СЕМАНТИЧЕСКАЯ ПАМЯТЬ: Факты, предпочтения, правила, цели        |  |
|  |  KNOWLEDGE GRAPH: Триплеты, связи между концептами               |  |
|  |  TEMPORAL DECAY: Затухание старых воспоминаний                   |  |
|  +------------------------------------------------------------------+  |
|                                                                        |
|  Уровень 1: PRIESTS (Жрецы) - РЕАЛИЗОВАНО                              |
|  +------------------------------------------------------------------+  |
|  |  EMBEDDING ENGINE: e5-small, 384-мерные векторы                  |  |
|  |  DEVICE MANAGEMENT: CUDA/CPU автоопределение                     |  |
|  |  PERSISTENCE: Сохранение памяти на диск                          |  |
|  +------------------------------------------------------------------+  |
|                                                                        |
|  Уровень 0: LOGOS (Логос) - РЕАЛИЗОВАНО                                |
|  +------------------------------------------------------------------+  |
|  |  INFERENCE: Mistral 7B Instruct v0.2                             |  |
|  |  TOKENIZATION: TokenOutputStream, BPE                            |  |
|  |  SAMPLING: Temperature, Top-K, Top-P, Repeat Penalty             |  |
|  +------------------------------------------------------------------+  |
|                                                                        |
+-----------------------------------------------------------------------+
```

---

## Двойственная Природа Памяти

Человеческая память делится на два типа, и ZIGGURAT следует этой модели:

### Эпизодическая Память
- **Что хранит:** События, диалоги, контекст
- **Вопрос:** "Что происходило?"
- **Характеристики:**
  - Временная привязка (когда это было?)
  - Эмоциональная окраска (как это ощущалось?)
  - Контекстная связность (что было до и после?)

### Семантическая Память
- **Что хранит:** Факты, концепции, знания
- **Вопрос:** "Что я знаю?"
- **Характеристики:**
  - Абстрактное знание (без привязки к времени)
  - Категоризация (факты, предпочтения, навыки)
  - Уверенность (confidence score)

### Пример Работы

**Пользователь:** "Помнишь, что я люблю?"

**Система извлекает:**
- **Эпизодическая память:** "Месяц назад пользователь сказал 'я люблю пиццу'"
- **Семантическая память:** "[preferences, 0.95] I love pizza"
- **Knowledge Graph:** "User -[loves]-> Pizza"

**Ответ:** "Да, ты говорил, что любишь пиццу!"

---

## Knowledge Graph

Граф знаний хранит **связи между концептами** в виде триплетов:

```
(Subject) -[Predicate]-> (Object)

Примеры:
- User -[loves]-> Pizza
- User -[works_at]-> IT Company
- Python -[is_a]-> Programming Language
- User -[wants_to_learn]-> Rust
```

### Возможности
- Автоматическое извлечение отношений из текста
- Поиск связанных концептов
- Temporal decay для старых связей
- Статистика графа

---

## Temporal Decay

Старые воспоминания "забываются" со временем - это естественно и для людей, и для AI:

### Конфигурация по категориям

| Категория | Период (дни) | Скорость затухания | Мин. уверенность |
|-----------|--------------|-------------------|------------------|
| Facts | 90 | 0.95 | 0.3 |
| Preferences | 60 | 0.90 | 0.2 |
| Rules | 180 | 0.98 | 0.4 |
| Skills | 120 | 0.95 | 0.3 |
| Goals | 30 | 0.85 | 0.2 |

### Формула
```
effective_confidence = base_confidence * (decay_rate ^ periods_elapsed)
```

Если `effective_confidence < min_confidence`, концепт может быть удален.

---

## Персонная Система (Demiurge)

### Архетипы

Архетипы определяют базовую "личность" AI:

| Архетип | Характер | Стиль |
|---------|----------|-------|
| `girlfriend` | Теплый, заботливый | Эмоциональный, поддерживающий |
| `programmer` | Технический, точный | Код-ориентированный |
| `devops` | Практичный | Инфраструктурный |
| `scientist` | Любопытный | Данные и факты |
| `philosopher` | Рефлексивный | Вопросы и метафоры |

### Эволюция

Персона развивается через взаимодействия:

```rust
EvolutionState {
    interactions_count: u64,    // Количество взаимодействий
    successful_helps: u64,      // Успешные помощи
    relationship_score: f32,    // Уровень отношений (0.0-1.0)
    trait_offsets: HashMap,     // Модификации черт
    unlocked_traits: Vec,       // Разблокированные черты
}
```

### Черты (Traits)

Черты влияют на поведение:
- `analytical` - Точность vs креативность
- `verbose` - Длина ответов
- `humor` - Использование юмора
- `empathy` - Эмоциональная поддержка
- `pedagogical` - Стиль объяснений

---

## Анти-Галлюцинационные Меры

### 1. Извлечение только из реплик пользователя
Модель не может "выдумать" факты из своего ответа.

### 2. Детекция саморяскрытий
Только явные утверждения:
- "я люблю X"
- "мой любимый X"
- "я работаю X"
- "я хочу X"

### 3. Дедупликация
При similarity > 0.92 новый концепт считается дубликатом.

### 4. Обнаружение противоречий
"люблю пиццу" vs "не люблю пиццу" - обновляется, не дублируется.

### 5. Regex Fallback
Если LLM возвращает невалидный JSON, применяется regex-извлечение.

---

## Data Flow

```
+------------------+
|   User Input     |
+--------+---------+
         |
         v
+--------+---------+
| Semantic Search  |  <-- Ищет релевантные концепты
+--------+---------+
         |
         v
+--------+---------+
| Episodic Search  |  <-- Ищет похожие диалоги (если нужно)
+--------+---------+
         |
         v
+--------+---------+
| Persona Context  |  <-- Добавляет персону и стиль
+--------+---------+
         |
         v
+--------+---------+
| LLM Generation   |  <-- Mistral 7B генерирует ответ
+--------+---------+
         |
         v
+--------+---------+
| Concept Extract  |  <-- Извлекает новые концепты из input
+--------+---------+
         |
         v
+--------+---------+
| Memory Update    |  <-- Сохраняет в эпизодическую + семантическую
+--------+---------+
         |
         v
+--------+---------+
|    Response      |
+------------------+
```

---

## Технический Стек

| Компонент | Технология |
|-----------|------------|
| LLM | Candle + Mistral 7B |
| Embeddings | Candle + e5-small |
| Serialization | Serde + Bincode |
| Persistence | JSON + Binary |
| CLI | Clap |
| Async | Tokio (планируется) |

---

## Принципы Разработки

### 1. Минимальный Жизнеспособный Продукт
Каждая фича должна работать end-to-end перед добавлением следующей.

### 2. Измеримость
Каждая задача должна иметь критерий успеха.

### 3. Инкрементальность
Маленькие, тестируемые изменения.

### 4. Память Превыше Генерации
Лучше запомнить правильно, чем сгенерировать красиво.

---

## Связанная Документация

- [README.md](../README.md) - Быстрый старт и TODO
- [DEMIURGE_GUIDE.md](DEMIURGE_GUIDE.md) - Система персон
- [PERSONA_MEMORY_INTEGRATION.md](PERSONA_MEMORY_INTEGRATION.md) - Интеграция памяти

---

**ZIGGURAT MIND - Building AI with Memory and Consciousness**
